<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Sistema de Agendamento</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body class="bg-system">

<header class="system-header">
    <div class="container">
        <h1>Sistema de Agendamento</h1>
        <p>Unidade Central</p>
    </div>
</header>

<div class="container mt-5">

    {% if pagina == "form" %}

    <div class="card system-card">

        <h3 class="mb-4">Agendamento de Consulta</h3>

        <form method="post" action="/agendar">

            <div class="mb-4">
                <label class="form-label">Nome Completo</label>
                <input type="text"
                       name="nome"
                       class="form-control form-control-lg"
                       required>
            </div>

            <div class="mb-4">
                <label class="form-label">Especialidade</label>
                <select name="especialidade"
                        class="form-select form-select-lg"
                        required>
                    <option value="">Selecione</option>
                    <option>Cardiologia</option>
                    <option>Dermatologia</option>
                    <option>Pediatria</option>
                    <option>Geriatria</option>
                    <option>Alergista</option>
                </select>
            </div>

            <!-- DATA -->
            <div class="mb-4">
                <label class="form-label">Data da Consulta</label>
                <select name="data_consulta"
                        id="data_consulta"
                        class="form-select form-select-lg"
                        required>
                    <option value="">Selecione uma data</option>
                    {% for data in datas_disponiveis.keys() %}
                        <option value="{{ data }}">{{ data }}</option>
                    {% endfor %}
                </select>
            </div>

            <!-- HORÁRIO -->
            <div class="mb-4">
                <label class="form-label">Horário da Consulta</label>
                <select name="horario_consulta"
                        id="horario_consulta"
                        class="form-select form-select-lg"
                        required>
                    <option value="">Selecione um horário</option>
                </select>
            </div>

            <button type="submit" class="btn btn-primary btn-lg w-100">
                Confirmar Agendamento
            </button>

        </form>

    </div>

    {% elif pagina == "resultado" %}

    <div class="card system-card text-center">

        <h3 class="text-success mb-3">
            Agendamento Confirmado
        </h3>

        <p><strong>Paciente:</strong> {{ nome }}</p>
        <p><strong>Especialidade:</strong> {{ especialidade }}</p>
        <p><strong>Data da Consulta:</strong> {{ data_consulta }}</p>
        <p><strong>Horário da Consulta:</strong> {{ horario_consulta }}</p>
        <p><strong>Data do Agendamento:</strong> {{ data }}</p>
        <p><strong>Horário do Sistema:</strong> {{ hora }}</p>

        <div class="protocol-box mt-4">
            <small>Número do Protocolo</small>
            <h4>{{ protocolo }}</h4>
        </div>

        <a href="{{ url_for('index') }}"
           class="btn btn-outline-primary mt-4 w-100">
            Novo Agendamento
        </a>

    </div>

    {% endif %}

</div>

<!-- SCRIPT PARA CARREGAR HORÁRIOS -->
<script>
    const agenda = {{ datas_disponiveis | tojson }};

    const dataSelect = document.getElementById("data_consulta");
    const horarioSelect = document.getElementById("horario_consulta");

    if (dataSelect) {
        dataSelect.addEventListener("change", function() {

            const dataEscolhida = this.value;

            horarioSelect.innerHTML = '<option value="">Selecione um horário</option>';

            if (agenda[dataEscolhida]) {
                agenda[dataEscolhida].forEach(function(horario) {
                    const option = document.createElement("option");
                    option.value = horario;
                    option.textContent = horario;
                    horarioSelect.appendChild(option);
                });
            }
        });
    }
</script>

</body>
</html>
